<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="./dist/css/main.css">
  <title>安装测试工具</title>
</head>
<body>
<div class="home">
  <header class="header">
    <i class="iconfont left-icon">&#xe6db;</i>
    <h1 class="title"><span way-data="home.name"></span><i class="iconfont arrow">&#xe645;</i></h1>
  </header>
  <div class="car-box">
  </div>
  <div class="state-one">
    <i class="iconfont left-icon">&#xe6df;</i>
    <i class="iconfont right-icon">&#xe6de;</i>
  </div>
  <div class="state-two">
    <div class="bg-btm">
      <ul class="state-list">
        <li class="li_wd">
          <i class="iconfont temperature">&#xe6dc;</i>
          <span class="txt">12℃</span>
        </li>
        <li class="li_gps">
          <i class="iconfont gps">&#xe6dd;</i>
          <span class="txt">4</span>
        </li>
        <li class="center start-btn">
          <div class="hover"></div>
        </li>
        <li class="li_dy">
          <i class="iconfont voltage">&#xe6d9;</i>
          <span class="txt">11V</span>
        </li>
        <li class="li_signal">
          <i class="iconfont signal"></i>
          <span class="txt">———</span>
        </li>
      </ul>
    </div>
  </div>
  <div class="state-three">
    <ul class="state-list">
      <li>
        <div class="btn top"></div>
        <div class="btn bottom"></div>
        <p class="txt">车锁</p>
      </li>
      <li>
        <div class="btn"></div>
        <p class="txt">熄火</p>
      </li>
      <li>
        <div class="btn"></div>
        <p class="txt">寻车</p>
      </li>
    </ul>
  </div>
</div>

<script type="text/javascript" src="./dist/js/main.js"></script>
<script type="text/javascript">
  var pageData = {};
  var imei = '869651023637275';
  function update() {
    $.ajax({
      type: 'GET',
      async: false,
      url: '/api/om/om/getDeviceStatus?search=imei_' + imei,
      dataType: 'jsonp',
      success: function (data) {
        if (data.result.resultCode == 3) {
          // 登陆超时
          window.location.href = 'login.html';
        } else if (data.result.resultCode) {
          // 其他请求错误类型
        } else {
          // 获取数据成功
          ROWS = data.entity; // 复制全局变量
          // 遍历重新封装数据
          IDARR = new Array(); // 记录id
          OBJARR = new Array(); // 记录对象

          for (var i = 0; i < data.entity.length; i++) {
            if (IDARR.indexOf(data.entity[i].terminalid)) { // 在数组中
              // OBJARR[OBJARR.length-1].push(data.entity[i]);//存入最后一个
            } else {
              var temp = new Array();
              temp.push(data.entity[i]);
              OBJARR.push(temp);
              IDARR.push(data.entity[i].terminalid);
            }
          }

          // 开始处理数据
          var arr = new Array();
          for (var i = 0; i < ROWS.length; i++) {
            var obj = ROWS[i];
            if (obj.imei == imei) {
              arr.push(obj);
            }
          }

          var html = SIRUI.getHtmlData(imei, arr);
          // var clientType = getTerminalClientType(imei, arr);
          // if (html != false) {
          //   if(clientType == 17){//wg设备的
          //     $("#wg_test_info").html(html);
          //     goToAnchor("wgTest");
          //   }else{//原来的设备的
          //     $("#test_info").html(html);
          //     goToAnchor("test");
          //   }
          // }
          updateData();
        }
      },
      error: function (err) {
        console.log(err);
      }
    });
  }

  function updateData() {
    if (parseInt(pageData.gpsstatus)) {
      $('.gps').addClass('c-red');
    } else {
      $('.gps').addClass('c-green');
    }

  }

  $(function () {
    way.set('home', {name: '渝B·CJ111'});
    $('.start-btn').click(function () {
      if (pageData.status == 4) {
        SIRUI.toast('<font color=red>该设备已经激活,无法测试控制功能!</font>', '#fff');
      } else {
        SIRUI.control('qd');
      }
    });
    update();
  });
</script>
</body>
</html>
